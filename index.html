<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Facture ‚Äî FADEL DIGITAL ELECTRONICS</title>
  <style>
    :root{
      --emerald: #009999;
      --muted: #6b7280;
      --table-bg: #f7faf9;
      --paper: #ffffff;
      --max-width: 900px;
      font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    *{box-sizing:border-box}
    body{
      background:#f2f6f8;
      margin:0;
      padding:28px;
      color:#111827;
    }
    .sheet{
      max-width:var(--max-width);
      margin:0 auto;
      background:var(--paper);
      padding:26px 30px;
      border-radius:10px;
      box-shadow:0 10px 30px rgba(15,23,42,0.06);
    }
    header{
      display:flex;
      gap:18px;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid #eef2f7;
      padding-bottom:14px;
      margin-bottom:14px;
      flex-wrap:wrap;
    }
    .logo{display:flex;align-items:center;gap:12px}
    .logo img{height:64px; width:auto; object-fit:contain; border-radius:8px; background:rgba(0,0,0,0.02); padding:6px}
    .company h1{margin:0; font-size:18px; color:var(--emerald); letter-spacing:0.4px}
    .company p{margin:0;color:var(--muted); font-size:13px}
    .meta p{ margin:2px 0; font-size:13px; color:var(--muted); text-align:right }

    .two-col{display:flex; gap:12px; justify-content:space-between; margin:14px 0 8px; flex-wrap:wrap}
    .card{background:var(--table-bg); padding:10px 12px; border-radius:8px; min-width:200px; flex:1}
    .card b{display:block; margin-bottom:6px; color:#0f172a}

    table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 8px;
  font-size: 13px;
  table-layout: fixed; /* fixe la largeur, mais permet wrap */
}
thead th {
  text-align: left;
  padding: 12px 10px;
  background: var(--emerald);
  color: white;
  font-weight: 700;
  font-size: 13px;
  border-top-left-radius: 6px;
  border-top-right-radius: 6px;
}
thead th:nth-child(1) { width: 50%; } /* colonne D√©signation √©largie */
thead th:nth-child(2) { width: 10%; }
thead th:nth-child(3) { width: 20%; }
thead th:nth-child(4) { width: 15%; }
thead th:nth-child(5) { width: 15%; }

tbody td {
  padding: 10px;
  border-bottom: 1px solid #e6eef2;
  vertical-align: middle;
  word-wrap: break-word;
}
input.cell {
  width: 100%;
  border: none;
  background: transparent;
  font-size: 13px;
  padding: 4px 6px;
  outline: none;
  white-space: normal;
  word-break: break-word;
}

    tbody td{ padding:10px; border-bottom:1px solid #e6eef2; vertical-align:middle }
    tbody tr:nth-child(even){ background:#ffffff }
    tbody tr:nth-child(odd){ background:#fbfbfb }

    .right{ text-align:right }
    .center{ text-align:center }

    input.cell {
      width:100%; border:none; background:transparent; font-size:13px; padding:4px 6px; outline:none;
    }
    input.cell.qty, input.cell.price { text-align:center }
    input.cell.ref { text-align:center }

    .action-btn { background:transparent; border:none; cursor:pointer; font-size:16px; padding:6px 8px; border-radius:6px }
    .action-btn.del { background:#ff4d4d; color:white }
    .action-btn.del:hover { opacity:0.9 }

    .controls { display:flex; justify-content:flex-end; gap:10px; margin-top:10px; flex-wrap:wrap }
    .print-btn { background:var(--emerald); color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:700 }
    .print-btn.ghost{ background:#f3fdfb; color:var(--emerald); border:1px solid rgba(0,153,153,0.12) }

    .totals{ margin-top:18px; display:flex; justify-content:space-between; gap:12px; align-items:center; flex-wrap:wrap }
    .totals .left{ color:var(--muted); font-size:13px }
    .totals .right{ min-width:260px; text-align:center }
    .amount{ font-size:20px; font-weight:800; color:var(--emerald); padding:10px 14px; border-radius:8px;
             background:linear-gradient(90deg, rgba(0,153,153,0.06), rgba(0,153,153,0.02)); display:inline-block; box-shadow:0 6px 18px rgba(0,153,153,0.04) }
    .amount-words{ margin-top:6px; font-size:13px; color:#0f172a; font-weight:600 }

    footer{ margin-top:26px; border-top:1px solid #eef2f7; padding-top:12px; color:#374151; font-size:12px; line-height:1.4 }

    /* responsive */
    @media (max-width:720px){
      header{ flex-direction:column; align-items:flex-start; gap:12px; }
      .meta{ text-align:left; }
      .amount{ font-size:18px; }
      .sheet{ padding:18px; }
      .controls { gap: 8px; }
      table { font-size:12px; }
      th, td { padding:8px; }
    }

    /* print */
    @media print{
      body{ background:white; padding:0; }
      .controls, .print-btn { display:none !important }
      .sheet{ box-shadow:none; border-radius:0; margin:0; padding:16mm }
      thead th { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      /* hide last column (action) in print */
      th:last-child, td:last-child { display:none !important; }
    }

    /* highlight where to type client name/address */
    .client-input { font-weight:700; border-bottom:1px dashed rgba(0,0,0,0.05); padding-bottom:2px; }
    /* ‚úÖ Colonne D√©signation plus large */
th:nth-child(1),
td:nth-child(1) {
  width: 55%; /* Augmente la largeur ici (ex. : 55% ou plus si tu veux) */
  white-space: normal; /* Permet le retour √† la ligne */
  word-wrap: break-word;
}

/* Les autres colonnes un peu plus √©troites */
th:nth-child(2), td:nth-child(2) {
  width: 10%;
  text-align: center;
}

th:nth-child(3), td:nth-child(3) {
  width: 15%;
  text-align: right;
}

th:nth-child(4), td:nth-child(4) {
  width: 20%;
  text-align: right;
}
/* --- RESPONSIVE MOBILE COMPLET --- */
@media (max-width: 720px) {

  body {
    padding: 10px;
  }

  .sheet {
    padding: 16px !important;
  }

  /* HEADER */
  header {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
    text-align: left;
  }

  .logo img {
    height: 48px;
  }

  .company h1 {
    font-size: 16px;
  }

  .meta {
    width: 100%;
    text-align: left !important;
  }

  /* TABLEAU */
  table {
    display: block;
    width: 100%;
    overflow-x: auto;
    font-size: 12px !important;
  }

  th, td {
    padding: 6px !important;
    white-space: normal !important;
  }

  /* ‚úÖ Agrandir la d√©signation sur mobile */
  th:nth-child(1),
  td:nth-child(1) {
    width: 65% !important; /* D√©signation vraiment large */
    white-space: normal !important;
    word-break: break-word !important;
  }

  /* Colonnes resserr√©es */
  th:nth-child(2), td:nth-child(2),
  th:nth-child(3), td:nth-child(3),
  th:nth-child(4), td:nth-child(4) {
    width: 12% !important;
    text-align: center !important;
  }

  /* Masquer la colonne Action sur mobile */
  th:nth-child(5),
  td:nth-child(5) {
    display: none !important;
  }

  /* INPUTS */
  input.cell {
    font-size: 12px !important;
    padding: 3px !important;
  }

  /* TOTAL */
  .totals {
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }

  .amount {
    font-size: 18px !important;
    padding: 8px 10px !important;
  }

  /* SIGNATURE */
  img[alt*="Cachet"] {
    width: 130px !important;
  }

  /* BOUTONS TOP */
  .controls {
    display: flex;
    justify-content: center !important;
    flex-wrap: wrap;
    gap: 6px;
  }

  .print-btn {
    width: 100% !important;
    font-size: 14px;
    padding: 10px !important;
  }
}
/* ‚úÖ Optimisation mobile ‚Äî sans changer le design */
@media (max-width: 600px) {

  body {
    padding: 8px !important;
  }

  .sheet {
    padding: 12px !important;
    margin: 0 !important;
  }

  header {
    flex-direction: column;
    align-items: flex-start;
  }

  .meta p {
    text-align: left !important;
  }

  /* ‚úÖ Table plus fluide */
  table {
    font-size: 12px !important;
    table-layout: auto !important;
    width: 100% !important;
  }

  th, td {
    padding: 6px !important;
    word-wrap: break-word !important;
    white-space: normal !important;
  }

  /* ‚úÖ D√©signation prend plus de place */
  th:nth-child(1),
  td:nth-child(1) {
    width: 60% !important;
  }

  /* ‚úÖ Quantit√© plus petite */
  th:nth-child(2),
  td:nth-child(2) {
    width: 10% !important;
    text-align: center !important;
  }

  /* ‚úÖ Prix plus visible */
  th:nth-child(3),
  td:nth-child(3) {
    width: 20% !important;
    text-align: right !important;
  }

  /* ‚úÖ R√©f√©rence un peu r√©duite */
  th:nth-child(4),
  td:nth-child(4) {
    width: 15% !important;
    text-align: center !important;
  }

  /* ‚úÖ Bouton supprimer visible mais pas trop large */
  th:nth-child(5),
  td:nth-child(5) {
    width: 10% !important;
    text-align: center !important;
  }

  /* ‚úÖ Boutons */
  .controls {
    flex-direction: column;
    gap: 6px;
    width: 100%;
  }

  .print-btn {
    width: 100%;
    text-align: center;
  }

  /* ‚úÖ Totaux bien affich√©s */
  .totals {
    flex-direction: column;
    text-align: center;
  }

  .totals .right {
    width: 100%;
    margin-top: 8px;
  }
}
/* ‚úÖ √âtendre le tableau √† 100% en mobile */
@media (max-width: 600px) {

  .sheet {
    padding: 8px !important;
    width: 100% !important;
    margin: 0 !important;
  }

  table {
    width: 100% !important;
    table-layout: fixed !important;
    border-collapse: collapse !important;
  }

  th, td {
    padding: 6px !important;
    word-wrap: break-word !important;
    white-space: normal !important;
  }

  /* ‚úÖ D√©signation encore plus large en mobile */
  th:nth-child(1),
  td:nth-child(1) {
    width: 65% !important;
  }

  /* ‚úÖ Le reste plus compact */
  th:nth-child(2), td:nth-child(2),
  th:nth-child(3), td:nth-child(3),
  th:nth-child(4), td:nth-child(4),
  th:nth-child(5), td:nth-child(5) {
    width: auto !important;
  }
}


  </style>
</head>
<body>
  <div class="sheet" id="facture-sheet">

    <div class="controls" id="controls">
      <button class="print-btn ghost" id="btn-add">+ Ajouter un produit</button>
      <button class="print-btn ghost" id="btn-clear">üßπ R√©initialiser</button>
      <button class="print-btn" id="downloadPdf">‚¨á T√©l√©charger PDF</button>
    </div>

    <header>
      <div class="logo">
        <img src="logo.jpg" alt="Logo FADEL DIGITAL" onerror="this.style.display='none'">
        <div class="company">
          <h1>FADEL DIGITAL ELECTRONICS</h1>
          <p>Dakar, Av Lamine Gu√®ye ‚Ä¢ T√©l : 77 299 05 00</p>
          <p style="margin-top:6px; font-size:12px; color:var(--muted)">NINEA : 010840040</p>
        </div>
      </div>

      <div class="meta">
        <p><strong>Facture N¬∞</strong> : <input id="invoice-number" class="cell" style="width:140px" value="FD-1025-01"></p>
        <p><strong>Date</strong> : <input id="invoice-date" class="cell" type="date"></p>
        <p style="margin-top:8px"><strong>Factur√© √† :</strong> <input id="client-name" class="cell client-input" placeholder="Nom du client"></p>
        <p>T√©l : <input id="client-phone" class="cell" placeholder="Num√©ro du client"></p>
        <p>Adresse : <input id="client-address" class="cell client-input" placeholder="Adresse du client"></p>
      </div>
    </header>

    <main>
      <div class="two-col">
        <div class="card">
          <b>Adresse boutique</b>
          <div>Dakar, Avenue Lamine Gu√®ye</div>
        </div>
      </div>

      <table id="items-table" aria-label="Tableau des articles">
        <thead>
          <tr>
            <th>D√©signation</th>
            <th class="center">Quantit√©</th>
            <th class="right">Prix Unitaire (FCFA)</th>
            <th class="center">R√©f√©rence</th>
            <th class="center">Action</th>
          </tr>
        </thead>
        <tbody>
          <!-- lignes ajout√©es dynamiquement -->
        </tbody>
      </table>

      <div class="totals" aria-hidden="false">
        <div class="left">
          <div><strong>Total :</strong> <span id="total">0</span> FCFA</div>
          <div style="margin-top:6px"><strong>Avance vers√©e :</strong> <input id="avance" class="cell" style="width:120px" value="0"></div>
        </div>

        <div class="right">
          <div class="amount" id="remaining-amount">0 FCFA</div>
          <div class="amount-words" id="amount-words">Z√©ro franc CFA</div>
        </div>
      </div>

      <div style="margin-top:30px; text-align:right;">

  <!-- Garantie 12 mois -->
  <p style="
    font-weight:700;
    font-size:14px;
    color:#009999;
    margin-bottom:10px;
  ">
    ‚úÖ Garantie : 12 mois sur tous les produits achet√©s
  </p>
        <img src="cachet.jpg" alt="Cachet Fadel Digital Electronics" style="width:180px; opacity:0.85;" onerror="this.style.display='none'">
        <p style="margin-top:6px; font-weight:700;">Fadel Digital Electronics</p>
      </div>

      <footer>
        <p style="font-weight:700; margin:0 0 8px 0">Conditions & garantie :</p>
        <p style="margin:0 0 8px 0;">
          Les articles restent la propri√©t√© du vendeur jusqu'au paiement complet.<br/>
          Tous nos produits sont garantis (Cette garantie ne couvre pas les d√©t√©riorations caus√©es par : un mauvais d√©placement ou une mauvaise installation non conforme √† la notice, les sur ou sous tensions √©lectriques, les √©crans cass√©s, les interventions effectu√©es par des agents non agr√©√©s par la soci√©t√©.)<br/>
          Les petits mat√©riels √©lectriques, tels que mixeurs, bouilloires, ventilateurs... ne sont pas garantis.
        </p>
        <p style="color:var(--muted); font-size:12px; margin-top:8px">Merci pour votre confiance !</p>
      </footer>
    </main>
  </div>

  <!-- html2pdf (bundle) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    /* ---------- utilitaires ---------- */
    function fmt(n){ return (n||0).toLocaleString('fr-FR'); }
    function parseNumber(str){
      if(str === undefined || str === null) return 0;
      return parseFloat(String(str).replace(/\s+/g,'').replace(/[^0-9\.\-]/g,'')) || 0;
    }

    function numberToWordsFr(n) {
  const units = ["z√©ro","un","deux","trois","quatre","cinq","six","sept","huit","neuf"];
  const teens = ["dix","onze","douze","treize","quatorze","quinze","seize","dix-sept","dix-huit","dix-neuf"];
  const tens = ["","dix","vingt","trente","quarante","cinquante","soixante","soixante","quatre-vingt","quatre-vingt"];

  if (n < 10) return units[n];
  if (n < 20) return teens[n - 10];

  if (n < 100) {
    let t = Math.floor(n / 10);
    let u = n % 10;

    if (t === 7 || t === 9) {
      return tens[t] + (u > 0 ? "-" + teens[u] : "");
    }

    return tens[t] + (u === 1 ? "-et-un" : u > 0 ? "-" + units[u] : "");
  }

  if (n < 1000) {
    let h = Math.floor(n / 100);
    let r = n % 100;
    return (h > 1 ? units[h] + "-cent" : h === 1 ? "cent" : "") + (r > 0 ? " " + numberToWordsFr(r) : "");
  }

  if (n < 1000000) {
    let th = Math.floor(n / 1000);
    let r = n % 1000;
    return (th > 1 ? numberToWordsFr(th) + " mille" : "mille") + (r > 0 ? " " + numberToWordsFr(r) : "");
  }

  if (n < 1000000000) {
    let m = Math.floor(n / 1000000);
    let r = n % 1000000;
    return (m > 1 ? numberToWordsFr(m) + " millions" : "un million") + (r > 0 ? " " + numberToWordsFr(r) : "");
  }

  return n.toLocaleString('fr-FR');
}


    /* ---------- gestion des lignes et totaux ---------- */
    let tbody, totalEl, remainingEl, amountWordsEl, avanceEl, controls;
    document.addEventListener('DOMContentLoaded', () => {
      tbody = document.querySelector("#items-table tbody");
      totalEl = document.getElementById("total");
      remainingEl = document.getElementById("remaining-amount");
      amountWordsEl = document.getElementById("amount-words");
      avanceEl = document.getElementById("avance");
      controls = document.getElementById("controls");

      // boutons
      document.getElementById('btn-add').addEventListener('click', () => addRow());
      document.getElementById('btn-clear').addEventListener('click', clearAll);

      // PDF
      document.getElementById('downloadPdf').addEventListener('click', downloadPdf);

      // load saved invoice if any
      loadInvoice();

      // refresh totals after load
      refreshTotals();

      // ensure pressing enter doesn't submit anything or reload
      window.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' && document.activeElement.tagName === 'INPUT'){
          e.preventDefault();
          refreshTotals();
        }
      });
    });

    function createRow(item = {}) {
  const tr = document.createElement("tr");

  const designation = item.designation || "";
  const qty = item.quantity !== undefined ? item.quantity : 1;
  const price = item.unit_price !== undefined ? item.unit_price : 0;
  const ref = item.reference || "";

  tr.innerHTML = `
    <td><input class="cell" data-field="designation" value="${escapeHtml(designation)}"></td>
    <td class="center"><input class="cell qty" data-field="quantity" type="number" min="0" value="${qty}"></td>
    <td class="right"><input class="cell price" data-field="price" type="number" min="0" value="${price}"></td>
    <td class="center"><input class="cell ref" data-field="reference" value="${escapeHtml(ref)}"></td>
    <td class="center"><button class="action-btn del" title="Supprimer la ligne">üóë</button></td>
  `;

  // bouton supprimer
  tr.querySelector(".action-btn.del").addEventListener("click", () => {
    tr.remove();
    saveInvoice();
    refreshTotals();
  });

  // input ‚Üí mise √† jour
  tr.querySelectorAll("input").forEach(inp => {
    inp.addEventListener("input", () => {
      saveInvoice();
      refreshTotals();
    });
  });

  return tr;
}


    function addRow(item = {}) {
      const r = createRow(item);
      tbody.appendChild(r);
      saveInvoice();
      refreshTotals();
      r.scrollIntoView({behavior:'smooth', block:'center'});
    }

    function clearAll(){
      if(!confirm("R√©initialiser la facture ? Cela supprimera toutes les lignes et les donn√©es locales.")) return;
      tbody.innerHTML = "";
      document.getElementById("client-name").value = "";
      document.getElementById("client-phone").value = "";
      document.getElementById("client-address").value = "";
      document.getElementById("invoice-number").value = "";
      document.getElementById("invoice-date").value = "";
      avanceEl.value = "0";
      saveInvoice();
      refreshTotals();
    }

    function refreshTotals(){
      let total = 0;
      tbody.querySelectorAll("tr").forEach(tr => {
        const qty = parseNumber(tr.querySelector('input[data-field="quantity"]').value) || 0;
        const price = parseNumber(tr.querySelector('input[data-field="price"]').value) || 0;
        total += qty * price;
      });
      const avance = parseNumber(avanceEl.value) || 0;
      const reste = total - avance;
      totalEl.innerText = fmt(total);
      remainingEl.innerText = fmt(reste) + " FCFA";
      const words = numberToWordsFr(Math.max(0, Math.round(reste)));
      amountWordsEl.innerText = (words ? (words.charAt(0).toUpperCase() + words.slice(1)) : "") + " francs CFA";
    }

    /* ---------- sauvegarde / restauration ---------- */
    const STORAGE_KEY = "fadel_facture_v1";
    function saveInvoice(){
      try{
        const data = {
          meta: {
            invoice_number: document.getElementById("invoice-number").value,
            date: document.getElementById("invoice-date").value,
            client_name: document.getElementById("client-name").value,
            client_phone: document.getElementById("client-phone").value,
            client_address: document.getElementById("client-address").value,
            avance: avanceEl.value
          },
          items: Array.from(tbody.querySelectorAll("tr")).map(tr => ({
            designation: tr.querySelector('input[data-field="designation"]').value,
            quantity: parseNumber(tr.querySelector('input[data-field="quantity"]').value)||0,
            unit_price: parseNumber(tr.querySelector('input[data-field="price"]').value)||0,
            reference: tr.querySelector('input[data-field="reference"]').value
          }))
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }catch(e){ console.error('saveInvoice', e); }
    }

    function loadInvoice(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) {
        // optionally prefill sample lines:
        // loadSample();
        return;
      }
      try {
        const data = JSON.parse(raw);
        document.getElementById("invoice-number").value = data.meta.invoice_number || "";
        document.getElementById("invoice-date").value = data.meta.date || "";
        document.getElementById("client-name").value = data.meta.client_name || "";
        document.getElementById("client-phone").value = data.meta.client_phone || "";
        document.getElementById("client-address").value = data.meta.client_address || "";
        avanceEl.value = data.meta.avance || "0";
        tbody.innerHTML = "";
        (data.items || []).forEach(it => addRow(it));
        refreshTotals();
      } catch(e){ console.error("loadInvoice", e); }
    }

    /* ---------- PDF export (fonctionnelle) ---------- */
    function sanitizeFileName(s){ return String(s||'client').trim().replace(/\s+/g,'_').replace(/[^\w.-]/g,''); }

    function downloadPdf() {
  try {
    saveInvoice();
    refreshTotals();

    const clientName = document.getElementById("client-name").value.trim() || "client";
    const filename = "Facture_" + clientName.replace(/\s+/g, "_") + ".pdf";

    const controls = document.getElementById("controls");
    const actionCells = document.querySelectorAll("th:last-child, td:last-child");

    const prevDisplay = {
      controls: controls.style.display,
      actions: Array.from(actionCells).map(el => el.style.display)
    };

    controls.style.display = "none";
    actionCells.forEach(el => el.style.display = "none");

    const element = document.getElementById("facture-sheet");

    const opt = {
      margin: 0.3,
      filename: filename,
      image: { type: "jpeg", quality: 1 },
      html2canvas: {
        scale: 2,
        useCORS: true,
        allowTaint: true,
        backgroundColor: "#ffffff"
      },
      jsPDF: { unit: "in", format: "a4", orientation: "portrait" },
    };

    html2pdf()
      .set(opt)
      .from(element)
      .save()
      .then(() => {
        controls.style.display = prevDisplay.controls;
        actionCells.forEach((el, i) => el.style.display = prevDisplay.actions[i]);
      })
      .catch(err => {
        console.error("Erreur PDF :", err);
        alert("Erreur lors de la g√©n√©ration du PDF.");
        controls.style.display = prevDisplay.controls;
        actionCells.forEach((el, i) => el.style.display = prevDisplay.actions[i]);
      });

  } catch (e) {
    console.error("Erreur downloadPdf:", e);
    alert("Une erreur est survenue pendant la g√©n√©ration du PDF.");
  }
}



    /* ---------- helpers ---------- */
    function escapeHtml(text){ return String(text||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    /* ---------- sample loader (optional) ---------- */
    function loadSample(){
      const sample = [
        { designation: "TELEVISEUR ASTECH 75'' SMART GOOGLE TV 75GT3024D", quantity:1, unit_price:540000, reference:"75GT3024D" },
        { designation: "SPLIT ASTECH 12000BTU 1.5 CV 12RBR410", quantity:4, unit_price:165000, reference:"12RBR410" },
        { designation: "SPLIT ASTECH 18000BTU 2CV 18RB410", quantity:1, unit_price:250000, reference:"18RB410" },
        { designation: "REFRIGERATEUR ASTECH SIDE BY SIDE 2 PORTES INVERTER + GLACON", quantity:1, unit_price:770000, reference:"FSS660DDA" }
      ];
      tbody.innerHTML = "";
      sample.forEach(it => addRow(it));
      saveInvoice();
      refreshTotals();
    }

    // Save on changes to avance and client info
    document.addEventListener('input', (e)=>{
      if(e.target && (e.target.id === 'avance' || e.target.id==='client-name' || e.target.id==='client-phone' || e.target.id==='client-address' || e.target.id==='invoice-number' || e.target.id==='invoice-date')){
        saveInvoice();
        refreshTotals();
      }
    });
  </script>
</body>
</html>